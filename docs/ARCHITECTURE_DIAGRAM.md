# Request Payload Input - Visual Architecture

## High-Level Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Actions                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  Browser DevTools        OR         Direct Input                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Network Tab  â”‚â”€â”€Copy Payloadâ”€â”€â–¶ â”‚ VS Code     â”‚             â”‚
â”‚  â”‚ Raw Request  â”‚                  â”‚ UCAN Viewer â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                           â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RequestPayloadInput                           â”‚
â”‚                     (Main Entry Point)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                             â”‚
                    â–¼                                             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  String Input      â”‚                        â”‚ Uint8Array Input â”‚
        â”‚  (from user)       â”‚                        â”‚ (from file)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Format Detection                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ base64url?   â”‚â”€â–¶â”‚ base64?      â”‚â”€â–¶â”‚ hex?         â”‚â”€â–¶       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚
â”‚         â”‚                                                â”‚      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                        â”‚                         â”‚
â”‚                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                                â”‚                â”‚               â”‚
â”‚                         bytes found?       no bytes             â”‚
â”‚                                â”‚                â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚                â”‚
                                 â–¼                â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Binary   â”‚    â”‚  JSON    â”‚
                          â”‚ Pipeline â”‚    â”‚ Pipeline â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚                â”‚
                                 â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Format-Specific Processing         â”‚               â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ processCAR  â”‚      â”‚ processCBOR â”‚      â”‚ processJSON â”‚    â”‚
â”‚  â”‚             â”‚      â”‚             â”‚      â”‚             â”‚    â”‚
â”‚  â”‚ â€¢ CarReader â”‚      â”‚ â€¢ CBOR.     â”‚      â”‚ â€¢ JSON.     â”‚    â”‚
â”‚  â”‚ â€¢ Scan      â”‚      â”‚   decode()  â”‚      â”‚   parse()   â”‚    â”‚
â”‚  â”‚   blocks    â”‚      â”‚ â€¢ Extract   â”‚      â”‚ â€¢ Extract   â”‚    â”‚
â”‚  â”‚ â€¢ Find      â”‚      â”‚   UCANs     â”‚      â”‚   UCANs     â”‚    â”‚
â”‚  â”‚   UCANs     â”‚      â”‚             â”‚      â”‚             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                     â”‚                     â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                     â”‚                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              extractUCANsFromObject (Recursive)                  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  For each value in object:                               â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  isUCAN(value)?  â”€â”€â”€Yesâ”€â”€â–¶  Add to ucans[]              â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚       No                                                  â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚  isInvocation(value)?  â”€â”€â”€Yesâ”€â”€â–¶  Add to invocations[]  â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚       No                                                  â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚  isCID(value) + reader?  â”€â”€â”€Yesâ”€â”€â–¶  Resolve & traverse  â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚       No                                                  â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚  isArray/Object?  â”€â”€â”€Yesâ”€â”€â–¶  Recurse into children       â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚       No                                                  â”‚  â”‚
â”‚  â”‚       â”‚                                                   â”‚  â”‚
â”‚  â”‚  Skip (primitive value)                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    parseUCAN (Proof Resolution)                  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  For each UCAN:                                          â”‚  â”‚
â”‚  â”‚    â€¢ Resolve all CID references in proof chain          â”‚  â”‚
â”‚  â”‚    â€¢ Recursively parse nested UCANs                     â”‚  â”‚
â”‚  â”‚    â€¢ Build complete delegation chain                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RequestPayloadResult                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ucans: UCAN[]                                           â”‚  â”‚
â”‚  â”‚  totalUCANs: number                                      â”‚  â”‚
â”‚  â”‚  invocations?: any[]                                     â”‚  â”‚
â”‚  â”‚  metadata?: {                                            â”‚  â”‚
â”‚  â”‚    format: "car" | "cbor" | "json"                      â”‚  â”‚
â”‚  â”‚    hasInvocations: boolean                               â”‚  â”‚
â”‚  â”‚  }                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              serializeUCANForDisplay (Formatting)                â”‚
â”‚  â€¢ Convert Uint8Arrays to readable strings                      â”‚
â”‚  â€¢ Decode DIDs (iss, aud)                                       â”‚
â”‚  â€¢ Format timestamps                                            â”‚
â”‚  â€¢ Convert CIDs to strings                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Webview Display                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“‹ Format: CAR                                          â”‚  â”‚
â”‚  â”‚  âœ… Contains invocation data                             â”‚  â”‚
â”‚  â”‚  ğŸ”‘ Found 2 UCANs                                        â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  === INVOCATIONS ===                                     â”‚  â”‚
â”‚  â”‚  [Invocation details]                                    â”‚  â”‚
â”‚  â”‚                                                           â”‚  â”‚
â”‚  â”‚  === UCANs ===                                           â”‚  â”‚
â”‚  â”‚  [UCAN 1 details]                                        â”‚  â”‚
â”‚  â”‚  [UCAN 2 details]                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Format Detection Decision Tree

```
Input String
    â”‚
    â”œâ”€ Try base64url decode â”€â”€â”¬â”€ Success â†’ bytes
    â”‚                         â””â”€ Fail â†’ Continue
    â”‚
    â”œâ”€ Try base64 decode â”€â”€â”€â”€â”€â”¬â”€ Success â†’ bytes
    â”‚                         â””â”€ Fail â†’ Continue
    â”‚
    â”œâ”€ Try hex decode â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ Success â†’ bytes
    â”‚                         â””â”€ Fail â†’ Continue
    â”‚
    â””â”€ Try JSON parse â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ Success â†’ JSON object
                              â””â”€ Fail â†’ Error

bytes
    â”‚
    â”œâ”€ Try CAR decode â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ Success & UCANs found â†’ Return
    â”‚                         â””â”€ Fail/No UCANs â†’ Continue
    â”‚
    â””â”€ Try CBOR decode â”€â”€â”€â”€â”€â”€â”€â”¬â”€ Success & UCANs found â†’ Return
                              â””â”€ Fail â†’ Error
```

## UCAN Detection Logic

```
Object
    â”‚
    â”œâ”€ Has 'v' property? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”œâ”€ Has 'iss' (Uint8Array)? â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”œâ”€ Has 'aud' (Uint8Array)? â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ All Yes = UCAN âœ“
    â””â”€ Has 'att' (Array)? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                       Any No = Not UCAN âœ—
```

## Invocation Detection Logic

```
Object
    â”‚
    â”œâ”€ Has 'invocation' property? â”€â”€â”€â”€â”€â”€â”€â”
    â”œâ”€ Has 'task' property? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â–¶ Any Yes = Invocation âœ“
    â””â”€ Has 'capabilities' property? â”€â”€â”€â”€â”€â”˜

                                         All No = Not Invocation âœ—
```

## Data Structures

### Input Types
```
string â”€â”€â”€â”€â”¬â”€â”€â–¶ base64url encoded
           â”œâ”€â”€â–¶ base64 encoded
           â”œâ”€â”€â–¶ hex encoded
           â””â”€â”€â–¶ JSON text

Uint8Array â”¬â”€â”€â–¶ CAR bytes
           â”œâ”€â”€â–¶ CBOR bytes
           â””â”€â”€â–¶ Raw binary
```

### Output Structure
```
RequestPayloadResult
    â”œâ”€â”€ ucans: UCAN[]
    â”‚   â”œâ”€â”€ v: string
    â”‚   â”œâ”€â”€ iss: Uint8Array (decoded to DID)
    â”‚   â”œâ”€â”€ aud: Uint8Array (decoded to DID)
    â”‚   â”œâ”€â”€ att: Capability[]
    â”‚   â”œâ”€â”€ exp?: number (formatted)
    â”‚   â”œâ”€â”€ prf?: CID[] (resolved)
    â”‚   â””â”€â”€ s?: Uint8Array (base64url)
    â”‚
    â”œâ”€â”€ totalUCANs: number
    â”‚
    â”œâ”€â”€ invocations?: any[]
    â”‚   â””â”€â”€ [invocation objects]
    â”‚
    â””â”€â”€ metadata?
        â”œâ”€â”€ format: "car" | "cbor" | "json"
        â””â”€â”€ hasInvocations: boolean
```

## Error Flow

```
Error Detected
    â”‚
    â”œâ”€ CAR decode error â”€â”€â–¶ Try CBOR
    â”œâ”€ CBOR decode error â”€â–¶ Try JSON
    â”œâ”€ JSON parse error â”€â”€â–¶ Return error with tips
    â””â”€ No UCANs found â”€â”€â”€â”€â–¶ Return "No UCANs found" + supported formats
```

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          â”‚        â”‚                  â”‚        â”‚          â”‚
â”‚ Webview  â”‚â—€â”€â”€â”€â”€â”€â”€â–¶â”‚  Extension Host  â”‚â—€â”€â”€â”€â”€â”€â”€â–¶â”‚ Adapter  â”‚
â”‚  (HTML)  â”‚ postMsgâ”‚    (main.ts)     â”‚  await â”‚  Logic   â”‚
â”‚          â”‚        â”‚                  â”‚        â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                       â”‚                        â”‚
     â”‚ UI Events             â”‚ Message Handler        â”‚ Processing
     â”‚ (Click, Paste)        â”‚ (decodePayload)        â”‚ (Extract UCANs)
     â”‚                       â”‚                        â”‚
     â–¼                       â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input    â”‚        â”‚ Result Message   â”‚        â”‚ UCAN     â”‚
â”‚ Payload  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶ {type, data,     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Objects  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  metadata}       â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Display Formattedâ”‚
                    â”‚ UCANs + Metadata â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
